
(function(j,h){function f(q,l){var p={},m=document.getElementById(q).elements,o=0,n;while(n=m[o++]){switch(n.nodeName.toLowerCase()){case"input":if("checkbox"===n.type.toLowerCase()){if(l&&!n.checked){break}p[n.name]=n.checked;break}if(n.value.length){p[n.name]=n.value}break;case"textarea":if(n.value.length){p[n.name]=n.value}break;case"select":if(n.value.length){p[n.name]=n.value}break}}return p}var c=function(m){m.preventDefault();var l=f("notice_form");h.post(this.action,l,function(v){v=JSON.parse(v);if(!v.error){showToast("success",v.message);var o=h("#mn li.active a");var x=h("#mn li.active a").attr("href");var n=x.search(/\?/);var w=x.substr(n+1);var s=x.substr(0,n);var q=w.split("&");for(var r=0;r<q.length;r++){var t=q[r].split("=");if(t[0]==="currentMonth"){q[r]="currentMonth="+v.month}}q.push("sort=-id");o.attr("href",s+"?"+q.join("&"));h("#mn li.active a").trigger("click");b()}else{showToast("error",v.message)}})};var d=function(m){m.preventDefault();var l=this;krajeeDialogCust.confirm("Действительно желает удалить запись с ID <i>"+l.parentNode.getAttribute("data-id")+"</i>",function(n){if(n){h.post(l.parentNode.getAttribute("href"),{id:l.parentNode.getAttribute("data-id")},function(o){o=JSON.parse(o);if(!o.error){showToast("success",o.message);h("#mn li.active a").trigger("click")}else{showToast("error",o.message)}})}})};var i=function(l){var m=h(".task-container");if(m.hasClass("expanded")){m.removeClass("expanded").addClass("collapsed");return true}if(m.hasClass("collapsed")){m.removeClass("collapsed").addClass("expanded");return true}};var a=function(l){var m=h(".form-container");if(m.hasClass("expanded")){b();return true}if(m.hasClass("collapsed")){g();return true}};var g=function(){e();h(".form-container").removeClass("collapsed").addClass("expanded")};var b=function(){h(".form-container").removeClass("expanded").addClass("collapsed")};var k=function(){h.get("/site/list",{},function(l){h(".list-container").html(l)})};var e=function(){h.get("/site/create",{},function(l){h(".form-container").html(l)})};h(document).ready(function(){k();h(document).on("submit","#notice_form",c);h(document).on("click",".glyphicon-trash",d);h(document).on("click",".btn-add-message",a);h(document).on("click",".btn-read-task",i)})})(window,jQuery);